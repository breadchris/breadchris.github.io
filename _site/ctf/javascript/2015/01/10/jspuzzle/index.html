<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>SECCON CTF 2014 jspuzzle Writeup &#8211; A Little (1 << 3) + y</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="A writeup of a fun little javascript challenge">
    <meta name="author" content="Chris">
    <meta name="keywords" content="ctf, javascript">
    <link rel="canonical" href="breadchris.github.io/ctf/javascript/2015/01/10/jspuzzle/">
    <link rel="alternate" type="application/rss+xml" title="RSS Feed for A Little (1 << 3) + y" href="/feed.xml" />

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/pixyll.css?201508120112" type="text/css">
    <link rel="stylesheet" href="/css/prism.css?201508120112" type="text/css">

    <!-- Fonts -->
    <link href='//fonts.googleapis.com/css?family=Merriweather:900,900italic,300,300italic' rel='stylesheet' type='text/css'>
    <link href='//fonts.googleapis.com/css?family=Lato:900,300' rel='stylesheet' type='text/css'>
    
      <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css" rel="stylesheet">
    


    <!-- Open Graph -->
    <!-- From: https://github.com/mmistakes/hpstr-jekyll-theme/blob/master/_includes/head.html -->
    <meta property="og:locale" content="en_US">
    <meta property="og:type" content="article">
    <meta property="og:title" content="SECCON CTF 2014 jspuzzle Writeup">
    <meta property="og:description" content="Blades out like Wolverine, but it was all a huge act man. ~ octobersveryown">
    <meta property="og:url" content="breadchris.github.io/ctf/javascript/2015/01/10/jspuzzle/">
    <meta property="og:site_name" content="A Little (1 &lt;&lt; 3) + y">

    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary" />
    
        <meta name="twitter:site" content="@breadchris" />
    
    <meta name="twitter:title" content="SECCON CTF 2014 jspuzzle Writeup" />
    <meta name="twitter:description" content="A writeup of a fun little javascript challenge" />
    <meta name="twitter:url" content="breadchris.github.io/ctf/javascript/2015/01/10/jspuzzle/" />

    <!-- Icons -->
    <link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/apple-touch-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="60x60" href="/apple-touch-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/apple-touch-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/apple-touch-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/apple-touch-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon-180x180.png">
    <link rel="icon" type="image/png" href="/favicon-192x192.png" sizes="192x192">
    <link rel="icon" type="image/png" href="/favicon-160x160.png" sizes="160x160">
    <link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96">
    <link rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16">
    <link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32">
        
    
    <script src="/js/prisim.js"></script>
</head>

<body class="site">
  <div class="site-wrap">
    <header class="site-header px2 px-responsive">
  <div class="mt2 wrap">
    <div class="measure">
      <a href="breadchris.github.io" class="site-title">A Little (1 << 3) + y</a>
      <nav class="site-nav">
        <a href="/about/">About</a>
<a href="/contact/">Contact</a>

      </nav>
      <div class="clearfix"></div>
      
        <div class="social-icons">
  <div class="left">
    
      <a class="fa fa-github" href="https://github.com/breadchris"></a>
    
    
    <a class="fa fa-rss" href="/feed.xml"></a>
    
      <a class="fa fa-twitter" href="https://twitter.com/breadchris"></a>
    
    
    
    
    
  </div>
  <div class="right">
    
    
    
  </div>
</div>
<div class="clearfix"></div>

      
    </div>
  </div>
</header>


    <div class="post p2 p-responsive wrap" role="main">
      <div class="measure">
        


<div class="post-header mb2">
  <h1>SECCON CTF 2014 jspuzzle Writeup</h1>
  <span class="post-meta">Jan 10, 2015</span><br>
    
  <span class="post-meta small">
  
    4 minute read
  
  </span>
</div>

<article class="post-content">
  <p>If you want to try it yourself, you can download it here: <a href="https://github.com/ctfs/write-ups/tree/master/seccon-ctf-2014/jspuzzle" title="jspuzzle" target="_blank"> jspuzzle on github</a></p>

<p>For the challenge, you were given a html page that presented you with a drag and drop form of code were specific parts of the code were blanked out and you must provide the form with the correct sequence of options from the provided bank of keywords/functions/strings. Once you were able to make the code execute and produce an alert with the value “1”, the sha1 generated from the submitted options would represent the correct flag for the challenge.</p>

<p>What you have to realize here is that Javascript has a lot of crazy syntax that you can pull off and the difficult part is trying to understand what words from the word bank would produce runnable code.</p>

<p>The solution for this challenge ended up being:</p>

<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><a name="True-1"></a><span class="s2">&quot;use strict&quot;</span><span class="p">;</span>
<a name="True-2"></a>
<a name="True-3"></a><span class="p">({</span> <span class="s2">&quot;function&quot;</span> <span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
<a name="True-4"></a>  <span class="k">this</span><span class="p">[</span> <span class="s2">&quot;null&quot;</span> <span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="k">new</span> <span class="nb">Function</span><span class="p">(</span> <span class="s2">&quot;return&quot;</span> <span class="o">+</span> <span class="s2">&quot;/*^_^*/&quot;</span> <span class="o">+</span> <span class="s2">&quot;this&quot;</span> <span class="p">))();</span>
<a name="True-5"></a>  <span class="kd">var</span> <span class="nx">pattern</span> <span class="o">=</span> <span class="s2">&quot;^[w]$&quot;</span><span class="p">;</span>
<a name="True-6"></a>  <span class="kd">var</span> <span class="nx">r</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">RegExp</span><span class="p">(</span> <span class="nx">pattern</span> <span class="p">);</span>
<a name="True-7"></a>  <span class="k">this</span><span class="p">[</span> <span class="nx">r</span><span class="p">[</span> <span class="s2">&quot;exec&quot;</span> <span class="p">](</span> <span class="nx">pattern</span> <span class="p">)</span> <span class="p">][</span> <span class="s2">&quot;alert&quot;</span> <span class="p">](</span> <span class="mi">1</span> <span class="p">);</span>
<a name="True-8"></a><span class="p">}})[</span> <span class="s2">&quot;Function&quot;</span> <span class="p">[</span> <span class="s2">&quot;toLowerCase&quot;</span> <span class="p">]()</span> <span class="p">]();</span></code></pre></div>

<p>Which is just a round-about way of doing “alert(1)”</p>

<p>So lets break this down a little.</p>

<p>The first part of the code: “use strict;” is “a way to opt in to a restricted variant of JavaScript” (<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Strict_mode">strict mode</a>). Now this code will still run without that line so we can conclude that it was just there as another step for you :D</p>

<p>The main function part was pretty cool:</p>

<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><a name="True-1"></a><span class="p">({</span> <span class="s2">&quot;function&quot;</span> <span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
<a name="True-2"></a>  <span class="k">this</span><span class="p">[</span> <span class="s2">&quot;null&quot;</span> <span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="k">new</span> <span class="nb">Function</span><span class="p">(</span> <span class="s2">&quot;return&quot;</span> <span class="o">+</span> <span class="s2">&quot;/*^_^*/&quot;</span> <span class="o">+</span> <span class="s2">&quot;this&quot;</span> <span class="p">))();</span>
<a name="True-3"></a>  <span class="kd">var</span> <span class="nx">pattern</span> <span class="o">=</span> <span class="s2">&quot;^[w]$&quot;</span><span class="p">;</span>
<a name="True-4"></a>  <span class="kd">var</span> <span class="nx">r</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">RegExp</span><span class="p">(</span> <span class="nx">pattern</span> <span class="p">);</span>
<a name="True-5"></a>  <span class="k">this</span><span class="p">[</span> <span class="nx">r</span><span class="p">[</span> <span class="s2">&quot;exec&quot;</span> <span class="p">](</span> <span class="nx">pattern</span> <span class="p">)</span> <span class="p">][</span> <span class="s2">&quot;alert&quot;</span> <span class="p">](</span> <span class="mi">1</span> <span class="p">);</span>
<a name="True-6"></a><span class="p">}})</span></code></pre></div>

<p><strong>An important thing that you must realize for this challenge is that Javascript indexes all its fields and functions in a key pair mapping. So something like <code>console.log()</code> can be rewritten as <code>console['log']()</code></strong></p>

<p>So when we do ({“key”: value}) we are creating a Javascript Object which the last part of the code will actually access. So in this case we are creating js object with mapping “function” to an actual callable function.</p>

<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><a name="True-1"></a><span class="k">this</span><span class="p">[</span><span class="s2">&quot;null&quot;</span><span class="p">]</span></code></pre></div>

<p>will set the “null” field of the current function context, or <code>this</code>, to be the return value of the function created on the left side of the assignment.</p>

<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><a name="True-1"></a><span class="k">new</span> <span class="nb">Function</span><span class="p">(</span> <span class="s2">&quot;return&quot;</span> <span class="o">+</span> <span class="s2">&quot;/*^_^*/&quot;</span> <span class="o">+</span> <span class="s2">&quot;this&quot;</span> <span class="p">)</span></code></pre></div>

<p>Javascript will create a new Function object by parsing the code given to the constructor, in this case our code will look like <code>return this</code>, which simply returns the current context of the function.</p>

<p>So we now have our null field of this referencing itself (what a great waste of time lol). The next two lines will create a Regex Javascript object with <code>"^[w]$"</code> which will only match the letter “w” (^ means that we start matching from the very beginning of the string and $ means we want the string to end with what we are matching. Since we are only matching the letter [w], “w” is the only possible string that would satisfy this regex). </p>

<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><a name="True-1"></a><span class="nx">r</span><span class="p">[</span> <span class="s2">&quot;exec&quot;</span> <span class="p">](</span> <span class="nx">pattern</span> <span class="p">)</span></code></pre></div>

<p>the code will now go to our r RegExp object and get the “exec” function (brackets in JS work similar to how they do in Python) and try to match our pattern string with “w”. Since “^[w]$” != “w”, exec will return null. Oh wait! Remember, we set this[“null”] to be a function that returns “this” right? So since exec returns null we have</p>

<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><a name="True-1"></a><span class="k">this</span><span class="p">[</span><span class="kc">null</span><span class="p">][</span><span class="s2">&quot;alert&quot;</span><span class="p">](</span><span class="mi">1</span><span class="p">)</span></code></pre></div>

<p>which is the same as this<a href="1">“alert</a> which is the same as alert(1)! Sweet :D</p>

<p>For the last part, </p>

<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><a name="True-1"></a><span class="p">[</span> <span class="s2">&quot;Function&quot;</span> <span class="p">[</span> <span class="s2">&quot;toLowerCase&quot;</span> <span class="p">]()</span> <span class="p">]();</span></code></pre></div>

<p>we can rewrite it as</p>

<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><a name="True-1"></a><span class="p">[</span><span class="s2">&quot;Function&quot;</span><span class="p">.</span><span class="nx">toLowerCase</span><span class="p">()]()</span></code></pre></div>

<p>which is the same as</p>

<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><a name="True-1"></a><span class="p">[</span><span class="s2">&quot;function&quot;</span><span class="p">]()</span></code></pre></div>

<p>and since this part is acting on the Object that we had in the previous part, we grab the function whose key is “function” (the alert function) and the parenthesis will execute this function.</p>

<p>Granted I was doing this with hindsight, it is still a simple, fun challenge to think differently about Javascript :D</p>

</article>









      </div>
    </div>
  </div>

  <footer class="center">
  <div class="measure">
    <small>
      Theme crafted with &lt;3 by <a href="http://johnotander.com">John Otander</a> (<a href="https://twitter.com/4lpine">@4lpine</a>).
    </small>
  </div>
</footer>

</body>
</html>
